<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>捷菲花藝 - 管理後台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#ff6b6b',
                        secondary: '#4a4a4a',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100">
    <div class="min-h-screen">
        <!-- 導航欄 -->
        <nav class="bg-white shadow-md">
            <div class="container mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <a href="index.html" class="text-2xl font-bold text-secondary">捷菲花藝</a>
                    <div class="flex items-center space-x-4">
                        <span id="adminName" class="text-gray-600"></span>
                        <button id="logoutBtn" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
                            登出
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- 主要內容 -->
        <div class="container mx-auto px-4 py-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold mb-6">圖片管理</h2>
                
                <!-- GitHub 設置 -->
                <div class="mb-8 p-4 border rounded-lg bg-gray-50">
                    <h3 class="text-xl font-bold mb-4">GitHub 設置</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 mb-2">GitHub 儲存庫</label>
                            <input type="text" id="repoName" placeholder="username/repository" class="w-full px-3 py-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">GitHub Token</label>
                            <input type="password" id="githubToken" class="w-full px-3 py-2 border rounded-lg">
                        </div>
                        <div class="flex items-end">
                            <button id="saveSettings" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600">
                                保存設置
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 新增圖片表單 -->
                <form id="addImageForm" class="mb-8 p-4 border rounded-lg">
                    <h3 class="text-xl font-bold mb-4">新增圖片</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 mb-2">圖片檔案</label>
                            <input type="file" id="imageFile" accept="image/*" class="w-full" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">標題</label>
                            <input type="text" id="imageTitle" class="w-full px-3 py-2 border rounded-lg" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">分類</label>
                            <input type="text" id="imageCategory" class="w-full px-3 py-2 border rounded-lg" required>
                        </div>
                        <div class="flex items-end">
                            <button type="submit" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-primary/90">
                                上傳圖片
                            </button>
                        </div>
                    </div>
                </form>

                <!-- 圖片列表 -->
                <div id="imageList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- 圖片將由 JavaScript 動態載入 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // 圖片配置
        let galleryImages = [
            {
                url: 'images/wedding.jpg',
                title: '婚禮花藝',
                category: '婚禮佈置'
            },
            {
                url: 'images/space.jpg',
                title: '空間佈置',
                category: '室內設計'
            },
            {
                url: 'images/gift.jpg',
                title: '花禮設計',
                category: '禮品花束'
            }
        ];

        // GitHub 設置
        let githubConfig = {
            repo: localStorage.getItem('githubRepo') || '',
            token: localStorage.getItem('githubToken') || ''
        };

        // 載入設置
        document.getElementById('repoName').value = githubConfig.repo;
        document.getElementById('githubToken').value = githubConfig.token;

        // 保存設置
        document.getElementById('saveSettings').addEventListener('click', () => {
            const repo = document.getElementById('repoName').value;
            const token = document.getElementById('githubToken').value;
            
            if (repo && token) {
                githubConfig.repo = repo;
                githubConfig.token = token;
                localStorage.setItem('githubRepo', repo);
                localStorage.setItem('githubToken', token);
                alert('設置已保存');
            } else {
                alert('請填寫完整的 GitHub 設置');
            }
        });

        // 上傳圖片到 GitHub
        async function uploadToGitHub(file, title) {
            if (!githubConfig.repo || !githubConfig.token) {
                alert('請先設置 GitHub 資訊');
                return null;
            }

            try {
                const filename = `${Date.now()}-${file.name}`;
                const content = await readFileAsBase64(file);
                
                const response = await fetch(`https://api.github.com/repos/${githubConfig.repo}/contents/images/${filename}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubConfig.token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: `Add image: ${title}`,
                        content: content.split(',')[1]
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    return data.content.download_url;
                } else {
                    throw new Error('上傳失敗');
                }
            } catch (error) {
                console.error('Error uploading to GitHub:', error);
                alert('上傳失敗：' + error.message);
                return null;
            }
        }

        // 讀取檔案為 Base64
        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // 載入圖片列表
        function loadImageList() {
            const imageList = document.getElementById('imageList');
            imageList.innerHTML = '';
            
            galleryImages.forEach((image, index) => {
                const div = document.createElement('div');
                div.className = 'bg-white rounded-lg shadow-md overflow-hidden';
                div.innerHTML = `
                    <img src="${image.url}" alt="${image.title}" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="font-bold mb-2">${image.title}</h3>
                        <p class="text-gray-600 mb-4">${image.category}</p>
                        <div class="flex justify-end space-x-2">
                            <button onclick="editImage(${index})" class="text-blue-500 hover:text-blue-700">
                                <i class="fas fa-edit"></i> 編輯
                            </button>
                            <button onclick="deleteImage(${index})" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-trash"></i> 刪除
                            </button>
                        </div>
                    </div>
                `;
                imageList.appendChild(div);
            });
        }

        // 新增圖片
        document.getElementById('addImageForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const file = document.getElementById('imageFile').files[0];
            const title = document.getElementById('imageTitle').value;
            const category = document.getElementById('imageCategory').value;

            if (file) {
                const imageUrl = await uploadToGitHub(file, title);
                if (imageUrl) {
                    const newImage = {
                        url: imageUrl,
                        title: title,
                        category: category
                    };
                    galleryImages.push(newImage);
                    loadImageList();
                    e.target.reset();
                }
            }
        });

        // 編輯圖片
        function editImage(index) {
            const image = galleryImages[index];
            const newTitle = prompt('請輸入新的標題', image.title);
            const newCategory = prompt('請輸入新的分類', image.category);
            
            if (newTitle && newCategory) {
                galleryImages[index] = {
                    ...image,
                    title: newTitle,
                    category: newCategory
                };
                loadImageList();
            }
        }

        // 刪除圖片
        function deleteImage(index) {
            if (confirm('確定要刪除這張圖片嗎？')) {
                galleryImages.splice(index, 1);
                loadImageList();
            }
        }

        // 登出
        document.getElementById('logoutBtn').addEventListener('click', () => {
            if (confirm('確定要登出嗎？')) {
                window.location.href = 'index.html';
            }
        });

        // 頁面加載時執行
        document.addEventListener('DOMContentLoaded', () => {
            loadImageList();
            // 顯示管理員名稱
            document.getElementById('adminName').textContent = '管理員';
        });
    </script>
</body>
</html> 